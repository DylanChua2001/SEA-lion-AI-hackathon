<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>HealthHub Agent</title>
    <style>
      body { font-family: system-ui, sans-serif; width: 340px; margin: 10px; }
      textarea { width: 100%; box-sizing: border-box; height: 72px; }
      input[type="text"] { width: 100%; box-sizing: border-box; }
      .row { margin: 6px 0; }
      .small { font-size: 12px; color: #555; }
      .pill { display:inline-block; padding:2px 6px; border-radius:10px; font-size:12px; }
      .ok { background:#e6ffed; color:#036b26; }
      .bad { background:#ffecec; color:#8a1f11; }
      #log { white-space: pre-wrap; font-size: 12px; max-height: 180px; overflow-y: auto; background:#fafafa; border:1px solid #eee; padding:6px; }
      #info { font-size: 12px; background:#f7f9fc; border:1px solid #e6eef8; padding:8px; border-radius:6px; }
      label { display:block; margin: 6px 0 2px; }
      .inline { display:flex; align-items:center; gap:8px; }
      /* optional: nicer mic button */
      #mic { padding:6px 10px; border-radius:8px; border:1px solid #ddd; background:#fff; cursor:pointer; }
    </style>
  </head>
  <body>
    <h3>HealthHub Agent</h3>

    <div class="row">
      <label for="goal">What would you like to do?</label>
      <textarea id="goal" placeholder="e.g. View my HealthHub lab results OR general questions like 'How to renew passport?'"></textarea>
    </div>

    <!-- NEW: Speech-to-text controls -->
    <div class="row inline">
      <button id="mic">ðŸŽ¤ Speak</button>
      <span id="mic_status" class="small">Idle</span>
    </div>

    <!-- Thread controls: auto (default) or manual override -->
    <div class="row">
      <div class="inline">
        <input type="checkbox" id="auto_thread" checked />
        <label for="auto_thread" style="margin:0;">Auto-generate & remember thread</label>
      </div>
      <input id="thread_id" type="text" placeholder="(optional) custom thread id e.g. grandma-iphone" disabled />
      <div class="small">When auto is on, a UUID is stored and reused. Uncheck to use your own ID.</div>
    </div>

    <div class="row inline">
      <button id="run">Run</button>
      <span id="agent_health" class="pill bad">agent: â€¦</span>
      <span id="chat_health" class="pill bad">chat: â€¦</span>
    </div>

    <div id="info" class="row">
      <div><strong>Thread:</strong> <span id="info_thread">(not set)</span></div>
      <div><strong>Started:</strong> <span id="info_started">â€”</span></div>
      <div><strong>Messages (this popup):</strong> <span id="info_msgcount">0</span></div>
      <div><strong>Last reply:</strong> <span id="info_last">â€”</span></div>
    </div>

    <audio id="tts-player" controls style="display:none; width:100%; margin-top:6px;"></audio>
    <pre id="log" class="row"></pre>

    <script src="popup.js"></script>
  </body>
</html>
